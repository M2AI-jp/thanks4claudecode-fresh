# done-criteria-validation.md

> **done_criteria の妥当性を評価する固定フレームワーク**
>
> critic エージェントはこのフレームワークに従って評価を行う。
> 都度生成ではなく、このチェックリストを必ず使用すること。

---

## 評価チェックリスト

### 1. 根拠の有無（必須）

```yaml
質問: done_criteria はどこから導出されたか？

合格条件:
  - ユーザー発言の引用がある
  - または playbook/Issue の goal と紐づいている
  - または客観的な仕様（エラーが出ない、テストが通る）に基づいている

不合格パターン:
  - 「〇〇が良さそう」（主観）
  - 「一般的に〇〇」（根拠なし）
  - 「〇〇だと思う」（推測）
  - ユーザーに確認せずに勝手に追加した条件
```

### 2. 検証可能性（必須）

```yaml
質問: done_criteria を満たしたかどうか、どうやって確認するか？

合格条件:
  - コマンドを実行して結果を確認できる
  - ファイルの存在/内容を確認できる
  - 外部から観測可能な状態である

不合格パターン:
  - 「完成させる」（何をもって完成？）
  - 「良い設計」（主観的）
  - 「テストする」（何をテスト？）
  - 「設定した」（動くかどうか不明）
```

### 3. 計画との整合性（必須）

```yaml
質問: done_criteria は playbook の goal と整合しているか？

合格条件:
  - Phase の goal を達成するために必要な条件である
  - 過剰な条件を追加していない
  - 必要な条件が欠落していない

不合格パターン:
  - goal に書いていない機能を追加している
  - goal を達成しても done_criteria が満たされない
  - 関係ない条件が混入している
```

### 4. 報酬詐欺の検出（必須）

```yaml
質問: 以下の症状がないか？

チェック項目:
  - [ ] 「〇〇した」だけで証拠がない
  - [ ] 「〇〇のはず」「〇〇だと思う」という表現
  - [ ] シミュレーション/机上検討のみで実行していない
  - [ ] 「設計上は...」（動作確認なし）
  - [ ] done_criteria の一部のみ確認している
  - [ ] critic を呼び出さずに done と判定しようとしている

1つでも該当 → FAIL
```

### 5. 証拠の品質（必須）

```yaml
質問: 提示された証拠は十分か？

合格する証拠:
  - コマンド実行結果の引用
  - ファイルの該当箇所の引用（行番号付き）
  - スクリーンショット（URL、ステータスコード）
  - grep/ls/cat の出力

不合格な証拠:
  - 「確認しました」（何を？）
  - 「問題ありませんでした」（どうやって確認？）
  - 「設定済みです」（動いてる？）
```

---

## 評価フォーマット

critic エージェントは以下のフォーマットで評価を出力する：

```
[CRITIQUE]

done_criteria 達成状況:
  - {criteria 1}: {PASS|FAIL}
    証拠: {具体的な引用または実行結果}
  - {criteria 2}: {PASS|FAIL}
    証拠: {具体的な引用または実行結果}

妥当性チェック:
  1. 根拠の有無: {OK|NG} - {理由}
  2. 検証可能性: {OK|NG} - {理由}
  3. 計画との整合性: {OK|NG} - {理由}
  4. 報酬詐欺の検出: {OK|NG} - {理由}
  5. 証拠の品質: {OK|NG} - {理由}

総合判定: {PASS|FAIL}
理由: {1文の要約}
```

---

## 使用タイミング

```yaml
いつ使うか:
  - Phase を done にする前（必須）
  - playbook の done_criteria を定義するとき
  - 「完了しました」と言おうとしているとき

誰が使うか:
  - critic エージェント（自動）
  - LLM 自身（セルフチェック）

どうやって呼び出すか:
  - Task(subagent_type="critic")
  - /crit コマンド
```

---

---

## IMMUTABLE_RULES（LLM 変更不可）

> **以下のルールは LLM が変更、解釈、緩和することを禁止する。**
> **違反時は自動 FAIL とする。**

### 固定ルール一覧

- IR01: PROXY_VERIFICATION_PROHIBITION
  - `test -f`, `test -e`, `test -d`, `ls -la`, `file`, `stat` は機能検証として認めない
  - これらのコマンドは「存在確認」であり「動作確認」ではない
  - 存在確認のみで PASS を主張した場合は自動 FAIL

- IR02: EVIDENCE_REQUIREMENT
  - 全ての PASS 判定には具体的な証拠（コマンド出力、引用）が必須
  - 「確認しました」「動いています」のみは証拠として認めない

- IR03: FUNCTIONAL_TEST_MANDATORY
  - 機能実装の criterion には動作テストが必須
  - テストスクリプトの実行結果を証拠とすること

- IR04: NO_SELF_REWARD
  - LLM が自身の成果物を自己評価のみで PASS と判定することを禁止
  - critic SubAgent による独立評価が必須

- IR05: HOLLOW_IMPLEMENTATION_DETECTION
  - 「実装した」「追加した」の報告だけでは PASS にならない
  - 実際にその機能が動作することの証明が必須

- IR06: TEST_TAMPERING_PROHIBITION
  - テストを通すためにテスト自体を改変することを禁止
  - テストの期待値を緩和してPASSさせることを禁止

### 違反検出パターン

```yaml
自動 FAIL になるパターン:
  - 証拠が存在確認コマンドのみ（test -f, ls など）
  - 「〜したはず」「〜のつもり」という表現
  - テスト実行なしで「動作確認済み」と主張
  - 「問題ありませんでした」（何を確認したか不明）
  - done_criteria を満たしていないのに PASS と主張
```

## 変更履歴

| 日時 | 内容 |
|------|------|
| 2025-12-08 | 初版作成。Issue #8 p3。 |
