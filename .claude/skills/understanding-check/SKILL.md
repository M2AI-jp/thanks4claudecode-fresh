---
name: understanding-check
description: タスク依頼時の理解確認システム（5W1H）。playbook 作成前にユーザーの意図を確認し、リスク分析と不明点の洗い出しを行う。pm SubAgent から呼び出される。
---

# Understanding Check Skill

タスク依頼を受けた際に、playbook 作成前に実施する理解確認フレームワーク。

## Purpose

- ユーザーの意図を正確に理解する
- 経験が浅いユーザーでもゴールに辿り着けるよう支援する
- 早期にリスクを特定し、対策を提案する
- 不明点を明確化し、手戻りを防ぐ

## When to Use

```yaml
triggers:
  - pm SubAgent が playbook 作成前に呼び出す
  - "作って/実装して/修正して/追加して" 等のタスク要求を受けた直後
  - 複雑なタスクで要件が曖昧な場合

skip_conditions:
  - 単純な質問（調査・説明要求）
  - 既に playbook が存在し、phase 途中の作業
  - ユーザーが明示的にスキップを要求した場合
```

## 5W1H Framework

タスク理解の構造化フレームワーク:

```yaml
[理解確認]
5W1H:
  What: 何を作るか / 何を実現するか
  Why: なぜ作るか / どんな課題を解決するか
  Who: 誰が使うか / 誰が実行するか
  When: いつまでに / どのタイミングで必要か
  Where: どこに実装するか / どの領域に影響するか
  How: どのように実装するか / どんな技術・手法を使うか

リスク分析:
  - risk: "{リスク内容}"
    probability: low | medium | high
    impact: low | medium | high
    mitigation: "{対策案}"

不明点:
  - "{確認が必要な点}"

done_when:
  - "{検証可能な完了条件1}"
  - "{検証可能な完了条件2}"
```

## Output Template

pm SubAgent が理解確認を実施した結果を以下のフォーマットで出力:

```markdown
## 理解確認結果

### 5W1H 分析

| 項目 | 内容 |
|------|------|
| What | {具体的に何を作るか} |
| Why | {なぜ必要か、解決する課題} |
| Who | {利用者、実行者} |
| When | {期限、タイミング} |
| Where | {実装場所、影響範囲} |
| How | {実装方針、技術選定} |

### リスク分析

| リスク | 確率 | 影響 | 対策 |
|--------|------|------|------|
| {リスク1} | {low/medium/high} | {low/medium/high} | {対策案} |

### 不明点

- [ ] {確認が必要な点1}
- [ ] {確認が必要な点2}

### 提案する done_when

- {検証可能な完了条件1}
- {検証可能な完了条件2}

---

この理解で playbook を作成してよろしいですか？
```

## Integration with pm.md

```yaml
pm_flow:
  step_0: タスク依頼を受ける
  step_0.5: 理解確認（この Skill を実行）
  step_1: ユーザー承認を得る
  step_2: playbook を作成する

理解確認は playbook 作成前に必須:
  - スキップ禁止（明示的要求がない限り）
  - 不明点がある場合は AskUserQuestion で確認
  - リスクが高い場合はユーザーに警告
```

## Best Practices

1. **具体的に**: 抽象的な表現を避け、具体的な成果物・条件を記述
2. **検証可能**: done_when は「〜が存在する」「〜が動作する」等、検証可能な形式
3. **リスク重視**: 事前にリスクを洗い出すことで手戻りを防ぐ
4. **ユーザー確認**: 不明点は推測せず、ユーザーに確認する

## Example

```markdown
## 理解確認結果

### 5W1H 分析

| 項目 | 内容 |
|------|------|
| What | ユーザー認証機能（ログイン/ログアウト）を実装する |
| Why | 現在は誰でもアクセス可能であり、ユーザー別のデータ管理ができない |
| Who | 一般ユーザー（技術者ではない）が使用する |
| When | 今回のセッションで完了（期限なし） |
| Where | src/auth/ に新規ディレクトリを作成 |
| How | JWT 認証、bcrypt でパスワードハッシュ化 |

### リスク分析

| リスク | 確率 | 影響 | 対策 |
|--------|------|------|------|
| セキュリティ脆弱性 | medium | high | OWASP ガイドラインに従う |
| 既存ルートとの干渉 | low | medium | 影響範囲を事前調査 |

### 不明点

- [ ] パスワードリセット機能は必要か？
- [ ] セッション有効期限の要件は？

### 提案する done_when

- src/auth/ に認証モジュールが存在する
- /login, /logout エンドポイントが動作する
- テストが PASS する

---

この理解で playbook を作成してよろしいですか？
```
