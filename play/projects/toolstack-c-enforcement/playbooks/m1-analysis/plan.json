{
  "format_version": "2.0",
  "meta": {
    "id": "m1-analysis",
    "branch": "project/toolstack-c-enforcement",
    "created": "2026-01-08",
    "status": "active",
    "review_profile": "standard",
    "reviewed": true,
    "reviewed_by": "reviewer",
    "roles": {
      "orchestrator": "claudecode",
      "worker": "codex",
      "reviewer": "coderabbit",
      "human": "user"
    }
  },
  "goal": {
    "summary": "executor 使用状況を分析し、coderabbit が 0 件である根本原因の証拠を収集する",
    "done_when": [
      "executor 使用統計レポート（tmp/executor-usage-report.md）が存在する",
      "executor: reviewer と roles.reviewer: coderabbit の関係が分析されている",
      "context-cleanup playbooks がアーカイブされていない原因が特定されている",
      "根本原因仮説が文書化されている"
    ],
    "scope": {
      "includes": [
        "play/archive/**/*.json の executor 統計収集",
        "executor-resolver の出力形式分析",
        "role-resolver.sh の存在・動作確認",
        "archive-playbook.sh の動作確認"
      ],
      "excludes": [
        "修正の実装（M2/M3 で実施）",
        "新規 playbook での検証（M3 で実施）"
      ]
    }
  },
  "context": {
    "analysis_result": {
      "source": "prompt-analyzer",
      "data": {
        "5w1h": {
          "who": "Claude Code",
          "what": "executor 使用状況の分析と根本原因の証拠収集",
          "when": "即時（M1）",
          "where": "play/archive/, .claude/scripts/, .claude/skills/executor-resolver/",
          "why": "coderabbit が 0 件で toolstack C 設計が機能していない",
          "how": "ファイル分析、統計収集、フロー追跡"
        },
        "risks": {
          "technical": [
            {
              "risk": "分析が浅く根本原因を見逃す",
              "severity": "medium",
              "mitigation": "複数の観点から証拠を収集"
            }
          ]
        }
      }
    },
    "user_approved_understanding": {
      "source": "AUTO_APPROVED",
      "approved_at": "2026-01-08T08:00:00+09:00",
      "summary": "M1: 現状分析の実施",
      "approved_items": [
        "executor 使用統計の収集",
        "reviewer/coderabbit 対応の分析",
        "アーカイブ欠損の原因調査"
      ],
      "technical_requirements_confirmed": []
    }
  },
  "max_iterations": 5,
  "phases": [
    {
      "id": "p1",
      "name": "Executor 統計収集",
      "description": "アーカイブされた全 playbook から executor 使用状況を収集",
      "depends_on": [],
      "subtasks": [
        {
          "id": "p1.1",
          "criterion": "play/archive/**/*.json から executor 別の使用回数が集計されている",
          "executor": "claudecode",
          "coding": false,
          "validation_plan": {
            "technical": "grep で executor フィールドを抽出し、sort | uniq -c で集計",
            "consistency": "prompt-analyzer の事前分析と一致するか確認",
            "completeness": "全 plan.json が集計対象に含まれている"
          }
        },
        {
          "id": "p1.2",
          "criterion": "executor: reviewer の使用箇所と executor: coderabbit の使用箇所が列挙されている",
          "executor": "claudecode",
          "coding": false,
          "validation_plan": {
            "technical": "grep -n で行番号付きで抽出",
            "consistency": "coderabbit が 0 件であることが確認できる",
            "completeness": "全 archive 対象をスキャン"
          }
        }
      ]
    },
    {
      "id": "p2",
      "name": "Role Resolver 分析",
      "description": "executor: reviewer を coderabbit に解決する仕組みの有無を確認",
      "depends_on": ["p1"],
      "subtasks": [
        {
          "id": "p2.1",
          "criterion": "role-resolver.sh または同等の仕組みの存在が確認されている",
          "executor": "claudecode",
          "coding": false,
          "validation_plan": {
            "technical": "find または glob でファイル検索",
            "consistency": "state.md の roles 定義と整合するか確認",
            "completeness": ".claude/scripts/, .claude/hooks/ を全てスキャン"
          }
        },
        {
          "id": "p2.2",
          "criterion": "executor-resolver の出力形式（reviewer vs coderabbit）が文書化されている",
          "executor": "claudecode",
          "coding": false,
          "validation_plan": {
            "technical": "executor-resolver.md の出力フォーマットを確認",
            "consistency": "plan.json テンプレートの executor 定義と比較",
            "completeness": "全ての executor タイプについて確認"
          }
        }
      ]
    },
    {
      "id": "p3",
      "name": "Archive 欠損分析",
      "description": "context-cleanup playbooks がアーカイブされていない原因を調査",
      "depends_on": ["p1"],
      "subtasks": [
        {
          "id": "p3.1",
          "criterion": "archive-playbook.sh のアーカイブ対象ディレクトリ処理ロジックが確認されている",
          "executor": "claudecode",
          "coding": false,
          "validation_plan": {
            "technical": "archive-playbook.sh を読み、playbooks/ の扱いを確認",
            "consistency": "実際のディレクトリ構造と比較",
            "completeness": "project 用アーカイブ（archive-project.sh）も確認"
          }
        },
        {
          "id": "p3.2",
          "criterion": "context-cleanup/playbooks/ が空である原因が特定されている",
          "executor": "claudecode",
          "coding": false,
          "validation_plan": {
            "technical": "ls -la でディレクトリ内容を確認",
            "consistency": "project.json の playbook パス定義と比較",
            "completeness": "他の project アーカイブも同様の問題がないか確認"
          }
        }
      ]
    },
    {
      "id": "p4",
      "name": "根本原因仮説の文書化",
      "description": "収集した証拠から根本原因仮説を作成",
      "depends_on": ["p2", "p3"],
      "subtasks": [
        {
          "id": "p4.1",
          "criterion": "tmp/executor-usage-report.md に統計・分析結果・根本原因仮説が記載されている",
          "executor": "claudecode",
          "coding": false,
          "validation_plan": {
            "technical": "ファイル存在確認（test -f）",
            "consistency": "p1-p3 で収集した証拠が全て含まれている",
            "completeness": "M2 で検証すべき仮説が明確に列挙されている"
          }
        }
      ]
    },
    {
      "id": "p_final",
      "name": "Final review",
      "description": "Independent verification of done_when",
      "depends_on": ["p4"],
      "subtasks": [
        {
          "id": "p_final.1",
          "criterion": "Reviewer verification passes for all done_when items",
          "executor": "reviewer",
          "coding": false,
          "validation_plan": {
            "technical": "全 done_when 項目を検証コマンドで確認",
            "consistency": "レポートと playbook の記述が一致",
            "completeness": "4 つの done_when 項目全てが検証済み"
          }
        }
      ]
    }
  ],
  "final_tasks": []
}
