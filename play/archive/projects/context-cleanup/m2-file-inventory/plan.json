{
  "format_version": "2.0",
  "meta": {
    "id": "m2-file-inventory",
    "type": "playbook",
    "branch": "project/context-cleanup",
    "created": "2026-01-08",
    "status": "active",
    "review_profile": "standard",
    "reviewed": true,
    "reviewed_by": "reviewer",
    "parent_project": "context-cleanup",
    "milestone": "m2",
    "roles": {
      "orchestrator": "claudecode",
      "worker": "claudecode",
      "reviewer": "coderabbit",
      "human": "user"
    }
  },
  "goal": {
    "summary": "リポジトリ全体のファイルを走査し、カテゴリ別に分類したレポートを作成する",
    "done_when": [
      "tmp/file-inventory-report.md が存在する",
      "レポートに全ファイルのカテゴリ別一覧が含まれている",
      "レポートに削除候補セクションと各ファイルの削除理由が記載されている"
    ],
    "scope": {
      "includes": [
        "リポジトリ全体のファイル走査",
        "カテゴリ別分類（コア、設定、ログ、アーカイブ等）",
        "削除候補リストの作成"
      ],
      "excludes": [
        ".git ディレクトリ",
        "実際の削除（M3 で実行）"
      ]
    }
  },
  "context": {
    "analysis_result": {
      "source": "prompt-analyzer",
      "data": {
        "file_inventory": {
          "review_candidates": [
            {
              "category": "セッションログ",
              "path": ".claude/logs/sessions/*.md",
              "recommendation": "古いログは削除可能（最新5件程度を残す）"
            },
            {
              "category": "アーカイブ済み playbook",
              "path": "play/archive/*",
              "recommendation": "履歴として価値があるが、コンテキスト汚染源"
            },
            {
              "category": "tmp/",
              "path": "tmp/*",
              "recommendation": "一時ファイルは削除可能"
            },
            {
              "category": ".DS_Store",
              "path": ".DS_Store",
              "recommendation": "削除（macOS 自動生成ファイル）"
            }
          ]
        }
      }
    },
    "user_approved_understanding": {
      "source": "AUTO_FLOW",
      "approved_at": "2026-01-08"
    }
  },
  "max_iterations": 3,
  "phases": [
    {
      "id": "p1",
      "name": "ファイル走査とカテゴリ分類",
      "description": "リポジトリ全体のファイルを走査し、カテゴリ別に分類する",
      "depends_on": [],
      "subtasks": [
        {
          "id": "p1.1",
          "criterion": "tmp/file-inventory-report.md が存在し、全ファイルのカテゴリ別一覧が含まれている",
          "executor": "claudecode",
          "coding": false,
          "validation_plan": {
            "technical": "test -f tmp/file-inventory-report.md でファイル存在を確認",
            "consistency": "リポジトリ内の全ファイルがレポートに含まれている",
            "completeness": "コア、設定、ログ、アーカイブ等のカテゴリが網羅されている"
          }
        },
        {
          "id": "p1.2",
          "criterion": "レポート内に '## 削除候補' セクションが存在し、各ファイルに削除理由が記載されている",
          "executor": "claudecode",
          "coding": false,
          "validation_plan": {
            "technical": "grep '## 削除候補' tmp/file-inventory-report.md が成功する",
            "consistency": "削除理由がコンテキスト汚染の観点で一貫している",
            "completeness": "削除候補全てに理由が付与されている"
          }
        }
      ]
    },
    {
      "id": "p_final",
      "name": "Final review",
      "description": "全 done_when 条件の独立検証",
      "depends_on": ["p1"],
      "subtasks": [
        {
          "id": "p_final.1",
          "criterion": "critic による全 done_when 項目の検証が PASS している",
          "executor": "critic",
          "coding": false,
          "validation_plan": {
            "technical": "critic が各 done_when を検証コマンドで確認",
            "consistency": "レポート内容が分析結果と整合している",
            "completeness": "全 done_when 項目が達成されている"
          }
        }
      ]
    }
  ],
  "final_tasks": []
}
