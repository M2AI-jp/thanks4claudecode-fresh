{
  "_template_rules": {
    "criterion": {
      "MUST": "State what must be true, not what to do",
      "MUST": "Be verifiable by command execution",
      "FORBIDDEN": ["〜する", "〜した", "確認する", "検証する", "適切", "正しく", "良い", "かつ", "および", "〜し、", "存在し、"],
      "GOOD_EXAMPLES": [
        "ファイル X が存在する",
        "jq '.field' が Y を返す",
        "grep -c 'pattern' が N 以上"
      ],
      "BAD_EXAMPLES": [
        "ファイルを作成する",
        "適切に設定されている",
        "正しく動作する",
        "ファイル X が存在し、関数 Y が定義されている"
      ]
    },
    "command": {
      "MUST": ["Be a shell command that can be executed", "Return verifiable output or exit code", "1 command = 1 検証操作（&& や ; での結合禁止）"],
      "FORBIDDEN": ["Execute ...", "Compare ...", "Review ...", "Check ...", "複数操作を && で結合"],
      "GOOD_EXAMPLES": [
        "test -f path",
        "jq -e '.field' file.json",
        "grep -c 'pattern' file"
      ],
      "BAD_EXAMPLES": [
        "Execute the test",
        "Compare with expected",
        "Manually verify",
        "test -f path && grep -q 'pattern' path"
      ]
    },
    "expected": {
      "MUST": "Be a concrete value or condition",
      "FORBIDDEN": ["適切", "正常", "正しく", "All ...", "100% ..."],
      "GOOD_EXAMPLES": [
        "exists",
        "exit 0",
        "true",
        ">= 1",
        "\"completed\""
      ],
      "BAD_EXAMPLES": [
        "正常終了",
        "All pass",
        "100% match"
      ]
    },
    "subtask": {
      "MUST": ["1 subtask = 1 状態変化（単一の検証可能な変更）"],
      "FORBIDDEN": ["複数の変更を1つの subtask にまとめる", "複合 criterion（かつ/および/〜し、を含む）"]
    }
  },
  "format_version": "2.2",
  "meta": {
    "id": "example-playbook-id",
    "branch": "feat/example-feature",
    "created": "YYYY-MM-DD",
    "status": "draft",
    "review_profile": "standard",
    "reviewed": false,
    "reviewed_by": "",
    "roles": {
      "orchestrator": "claudecode",
      "worker": "codex",
      "reviewer": "coderabbit",
      "human": "user"
    }
  },
  "goal": {
    "summary": "Implement X to achieve Y (one sentence, specific)",
    "done_when": [
      {
        "criterion": "src/feature.ts が存在する",
        "command": "test -f src/feature.ts",
        "expected": "exit 0"
      },
      {
        "criterion": "src/feature.ts に export function X が含まれる",
        "command": "grep -c 'export function X' src/feature.ts",
        "expected": ">= 1"
      },
      {
        "criterion": "npm test が exit 0 で終了する",
        "command": "npm test",
        "expected": "exit 0"
      }
    ],
    "scope": {
      "includes": ["List specific files or features"],
      "excludes": ["List what is NOT in scope"]
    }
  },
  "context": {
    "analysis_result": {
      "source": "prompt-analyzer",
      "data": {}
    },
    "user_approved_understanding": {
      "source": "",
      "approved_at": "",
      "summary": "",
      "approved_items": [],
      "technical_requirements_confirmed": []
    }
  },
  "max_iterations": 5,
  "phases": [
    {
      "id": "p1",
      "name": "Implementation",
      "description": "Implement the core feature",
      "depends_on": [],
      "subtasks": [
        {
          "id": "p1.1",
          "criterion": "src/feature.ts が存在する",
          "executor": "codex",
          "coding": true,
          "validation_plan": {
            "technical": {
              "type": "automated",
              "command": "test -f src/feature.ts",
              "expected": "exit 0"
            },
            "consistency": {
              "type": "automated",
              "command": "grep -c 'import.*feature' src/index.ts",
              "expected": ">= 1"
            },
            "completeness": {
              "type": "automated",
              "command": "jq '.compilerOptions.strict' tsconfig.json",
              "expected": "true"
            }
          }
        }
      ]
    },
    {
      "id": "p_final",
      "name": "Final verification",
      "description": "Execute all done_when commands and verify results",
      "depends_on": ["p1"],
      "subtasks": [
        {
          "id": "p_final.1",
          "criterion": "src/feature.ts が存在する（done_when[0]）",
          "executor": "coderabbit",
          "coding": false,
          "validation_plan": {
            "technical": {
              "type": "automated",
              "command": "test -f src/feature.ts",
              "expected": "exit 0"
            },
            "consistency": {
              "type": "automated",
              "command": "ls -la src/feature.ts",
              "expected": "file exists"
            },
            "completeness": {
              "type": "automated",
              "command": "file src/feature.ts",
              "expected": "text"
            }
          }
        },
        {
          "id": "p_final.2",
          "criterion": "src/feature.ts に export function X が含まれる（done_when[1]）",
          "executor": "coderabbit",
          "coding": false,
          "validation_plan": {
            "technical": {
              "type": "automated",
              "command": "grep -c 'export function X' src/feature.ts",
              "expected": ">= 1"
            },
            "consistency": {
              "type": "automated",
              "command": "grep 'export function X' src/feature.ts",
              "expected": "not empty"
            },
            "completeness": {
              "type": "automated",
              "command": "wc -l src/feature.ts",
              "expected": ">= 1"
            }
          }
        },
        {
          "id": "p_final.3",
          "criterion": "npm test が exit 0 で終了する（done_when[2]）",
          "executor": "coderabbit",
          "coding": false,
          "validation_plan": {
            "technical": {
              "type": "automated",
              "command": "npm test",
              "expected": "exit 0"
            },
            "consistency": {
              "type": "automated",
              "command": "npm run test:unit",
              "expected": "exit 0"
            },
            "completeness": {
              "type": "automated",
              "command": "npm run lint",
              "expected": "exit 0"
            }
          }
        }
      ]
    }
  ],
  "final_tasks": []
}
