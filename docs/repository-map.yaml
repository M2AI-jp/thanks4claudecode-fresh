# Repository Map
#
# ãƒªãƒã‚¸ãƒˆãƒªå†…ã®å…¨ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
#
# ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ: .claude/hooks/generate-repository-map.sh
# æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°: playbook å®Œäº†æ™‚
#
# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚æ‰‹å‹•ç·¨é›†ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚

meta:
  generated: "2026-01-27 23:29:20"
  generator: ".claude/hooks/generate-repository-map.sh"
  total_files: 243

hooks:
  directory: .claude/hooks/
  count: 6
  files:
    - name: "generate-repository-map.sh"
    - name: "post-tool.sh"
    - name: "pre-tool.sh"
    - name: "prompt.sh"
    - name: "session.sh"
    - name: "subagent-stop.sh"

events:
  directory: .claude/events/
  count: 11
  units:
    - name: "lib"
      chain: "chain.sh"
      description: ""
    - name: "notification"
      chain: "chain.sh"
      description: "chain.sh - event unit: notification"
    - name: "post-tool-edit"
      chain: "chain.sh"
      description: "chain.sh - event unit: post-tool-edit"
    - name: "pre-compact"
      chain: "chain.sh"
      description: "chain.sh - event unit: pre-compact"
    - name: "pre-tool-bash"
      chain: "chain.sh"
      description: "chain.sh - event unit: pre-tool-bash"
    - name: "pre-tool-edit"
      chain: "chain.sh"
      description: "chain.sh - event unit: pre-tool-edit"
    - name: "session-end"
      chain: "chain.sh"
      description: "chain.sh - event unit: session-end"
    - name: "session-start"
      chain: "chain.sh"
      description: "chain.sh - event unit: session-start"
    - name: "stop"
      chain: "chain.sh"
      description: "chain.sh - event unit: stop"
    - name: "subagent-stop"
      chain: "chain.sh"
      description: "chain.sh - event unit: subagent-stop"
    - name: "user-prompt-submit"
      chain: "chain.sh"
      description: "chain.sh - event unit: user-prompt-submit"

agents:
  directory: .claude/skills/*/agents/
  registry: .claude/agents/
  note: "SubAgents ã®æ­£è¦å®šç¾©ã¯ skills å†…ã€Task ã¯ .claude/agents ã‚’å‚ç…§"
  count: 7
  files:
    - name: "executor-resolver"
      skill: "executor-resolver"
      description: "è¨­è¨ˆæ„å›³"
    - name: "codex-delegate"
      skill: "golden-path"
      description: "Codex MCP ã‚’ãƒ©ãƒƒãƒ—ã—ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè†¨å¼µã‚’é˜²æ­¢ã™ã‚‹ SubAgent"
    - name: "pm"
      skill: "golden-path"
      description: "é‡è¦"
    - name: "prompt-analyzer"
      skill: "prompt-analyzer"
      description: "description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’åˆ†æã— topic_type ã‚’åˆ¤å®šã™ã‚‹"
    - name: "coderabbit-delegate"
      skill: "quality-assurance"
      description: "CodeRabbit CLI ã‚’ãƒ©ãƒƒãƒ—ã—ã€ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è‡ªå‹•å®Ÿè¡Œã™ã‚‹ SubAgent"
    - name: "reviewer"
      skill: "quality-assurance"
      description: "æ­£è¦ã‚½ãƒ¼ã‚¹"
    - name: "critic"
      skill: "reward-guard"
      description: "reviewer ã¨ã®é•ã„"

skills:
  directory: .claude/skills/
  invocation: "Claude ãŒæ–‡è„ˆã‹ã‚‰è‡ªå‹•æ¤œå‡ºã—ã¦ Skill ãƒ„ãƒ¼ãƒ«ã§å‘¼ã³å‡ºã™"
  usage: "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«ãƒãƒƒãƒã—ãŸã‚‰ç™ºç«ã€‚ãƒ¢ãƒ‡ãƒ«ä¸»å°ã§åˆ¤æ–­ã€‚"
  auto_invoke: true
  count: 13
  files:
    - name: "access-control"
      description: "ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡"
    - name: "executor-resolver"
      description: "è¨­è¨ˆæ„å›³"
    - name: "git-workflow"
      description: "Git/PR ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼"
    - name: "golden-path"
      description: "Core Contract #1: Golden Path"
    - name: "playbook-gate"
      description: "Core Contract #2: Playbook Gate"
    - name: "playbook-init"
      description: "åŸºæœ¬ã¯ prompt-analyzer ã®åˆ†æçµæœã‚’å—ã‘å–ã‚‹ã€‚AUTO_FLOW æ™‚ã¯ä¸è¶³åˆ†ã‚’è‡ªå‹•åˆ†æã"
    - name: "post-loop"
      description: "POST_LOOP - playbook å®Œäº†å¾Œã®å¾Œå‡¦ç†"
    - name: "prompt-analyzer"
      description: "description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’åˆ†æã—ã€topic_typeï¼ˆinstruction/question/contextï¼‰ã"
    - name: "quality-assurance"
      description: "å“è³ªä¿è¨¼"
    - name: "reward-guard"
      description: "Core Contract #3: Reward Fraud Prevention"
    - name: "session-manager"
      description: "ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†"
    - name: "state"
      description: "description: ã“ã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã® state.md ç®¡ç†ã€playbook é‹ç”¨ã®å°‚é–€çŸ¥è­˜ã€‚state"
    - name: "understanding-check"
      description: "prompt-analyzer ã® ambiguity ã‚’ä½¿ã£ã¦ç¢ºèªè³ªå•ã‚’æ˜ç¢ºåŒ–ã™ã‚‹"

commands:
  directory: .claude/commands/
  count: 0
  invocation: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ /command ã§æ˜ç¤ºçš„ã«å‘¼ã³å‡ºã™ï¼ˆä¾‹: /test, /lintï¼‰"
  usage: "å³åº§ã«å®Ÿè¡Œã•ã‚Œã‚‹ CLI æ©Ÿèƒ½ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã‚’æ˜ç¢ºã«åæ˜ ã€‚"
  files:

docs:
  directory: docs/
  count: 4
  files:
    - name: "ARCHITECTURE.md"
      description: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ãƒ™ãƒ¼ã‚¹ã®çŠ¶æ…‹é·ç§»ãƒãƒƒãƒ—"
    - name: "PROMPT_CHANGELOG.md"
      description: "> Change log for CLAUDE.md (Frozen Constitution)"
    - name: "core-feature-reclassification.md"
      description: "> SSOT: Hook Unit catalog + dependency map (ideal -> current -> missing)."

play:
  directory: play/
  subdirectories:
    active:
      description: "é€²è¡Œä¸­ã® playbookï¼ˆplan.json/progress.json/evidenceï¼‰"
      count: 0
    archive:
      description: "å®Œäº†ã—ãŸ playbook ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–"
      count: 27
    template:
      description: "playbook v2 ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ"
      count: 2

root:
  description: "ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«"
  files:
    - name: "CLAUDE.md"
      description: "```yaml"
    - name: "README.md"
      description: "Event-unit Claude Code harness using Hook -> Event Unit -> Skill/SubAgent."
    - name: "state.md"
      description: "ç¾åœ¨åœ°ã‚’ç¤ºã™ Single Source of Truth"
    - name: ".gitignore"
      description: ""
    - name: ".mcp.json"
      description: ""

# ==============================================================================
# System Specification (M025)
# Claude ã®è¡Œå‹•ãƒ«ãƒ¼ãƒ«ã® Single Source of Truth
# æ³¨: ãƒ•ãƒ­ãƒ¼è©³ç´°ã¯ workflows ã‚»ã‚¯ã‚·ãƒ§ãƒ³å‚ç…§ï¼ˆM027 MECE çµ±ä¸€ï¼‰
# ==============================================================================

system_specification:
  description: "Claude ã®è¡Œå‹•ãƒ«ãƒ¼ãƒ«ã® Single Source of Truth"
  note: "init_flow/loop_flow/post_loop_flow ã¯ workflows ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«çµ±ä¸€ï¼ˆMECEï¼‰"

  behavior_rules:
    description: "CLAUDE.md ã‹ã‚‰æŠ½å‡ºã—ãŸè¡Œå‹•ãƒ«ãƒ¼ãƒ«"
    core_principles:
      - "pdca_autonomy: playbook å®Œäº† â†’ milestone æ›´æ–° â†’ æ¬¡ playbook è‡ªå‹•ä½œæˆ"
      - "tdd_first: done_criteria = ãƒ†ã‚¹ãƒˆä»•æ§˜ã€æ ¹æ‹ å¿…é ˆ"
      - "validation: critic ã¯ frameworks/ ã‚’å‚ç…§"
      - "plan_based: playbook=null ã§ Edit/Write â†’ ãƒ–ãƒ­ãƒƒã‚¯"
      - "git_branch_sync: 1 playbook = 1 branch"
    mandatory_outputs:
      - "[è‡ªèª]: ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚"
    prohibited_actions:
      - (æŠ½å‡ºå¤±æ•—)

# ==============================================================================
# Hook Trigger Sequence (M027)
# å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæº–æ‹ ã®ç™ºç«é †åº
# https://code.claude.com/docs/ja/hooks
# ==============================================================================

hook_trigger_sequence:
  description: "Hook ã®ç™ºç«é †åºï¼ˆå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæº–æ‹ ï¼‰"
  order_reference: "SessionStart â†’ UserPromptSubmit â†’ PreToolUse â†’ PostToolUse â†’ Stop â†’ PreCompact â†’ SessionEnd â†’ Notification (async) â†’ SubagentStop (task)"
  triggers:
    - trigger: "SessionStart"
      description: "ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«ç™ºç«"
      matchers:
        - matcher: "*"
          hooks:
            - script: "session.sh'"
              description: ""
    - trigger: "UserPromptSubmit"
      description: "ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé€ä¿¡æ™‚ã«ç™ºç«"
      matchers:
        - matcher: "*"
          hooks:
            - script: "prompt.sh'"
              description: ""
    - trigger: "PreToolUse"
      description: "ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œå‰ã«ç™ºç«ï¼ˆmatcher ã§ãƒ•ã‚£ãƒ«ã‚¿å¯èƒ½ï¼‰"
      matchers:
        - matcher: "*"
          hooks:
            - script: "pre-tool.sh'"
              description: ""
    - trigger: "PostToolUse"
      description: "ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œå¾Œã«ç™ºç«ï¼ˆmatcher ã§ãƒ•ã‚£ãƒ«ã‚¿å¯èƒ½ï¼‰"
      matchers:
        - matcher: "*"
          hooks:
            - script: "post-tool.sh'"
              description: ""
    - trigger: "Stop"
      description: "ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­æ–­æ™‚ï¼ˆCtrl+C, /stopï¼‰ã«ç™ºç«"
      matchers:
        - matcher: "*"
          hooks:
            - script: "chain.sh'"
              description: ""
    - trigger: "PreCompact"
      description: "ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåœ§ç¸®å‰ã«ç™ºç«"
      matchers:
        - matcher: "*"
          hooks:
            - script: "chain.sh'"
              description: ""
    - trigger: "SessionEnd"
      description: "ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã«ç™ºç«"
      matchers:
        - matcher: "*"
          hooks:
            - script: "chain.sh'"
              description: ""
    - trigger: "Notification"
      description: "é€šçŸ¥é€ä¿¡æ™‚ã«ç™ºç«"
      matchers:
        - matcher: "*"
          hooks:
            - script: "chain.sh'"
              description: ""
    - trigger: "SubagentStop"
      description: "ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆTaskï¼‰å¿œç­”å®Œäº†æ™‚ã«ç™ºç«"
      matchers:
        - matcher: "*"
          hooks:
            - script: "subagent-stop.sh'"
              description: ""

# ==============================================================================
# Workflows (M027)
# çµ„ã¿åˆã‚ã›ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½ã§ã‚·ã‚¹ãƒ†ãƒ æ§‹é€ ã‚’æ•´ç†
# ==============================================================================

workflows:
  description: "è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒé€£æºã—ã¦1ã¤ã®æ©Ÿèƒ½ã‚’å®Ÿç¾ã™ã‚‹çµ„ã¿åˆã‚ã›ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«"
  modules:

    - id: init_flow
      name: "INIT"
      why: |
        LLM ã¯çŠ¶æ…‹ã‚’ä¿æŒã—ãªã„ãŸã‚ã€æ¯ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã«ç¾åœ¨åœ°ã‚’å†èªè­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
        state.md/playbook ã®å¼·åˆ¶èª­ã¿è¾¼ã¿ã«ã‚ˆã‚Šã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç¢ºå®Ÿã«å¾©å…ƒã™ã‚‹ã€‚
      when: "SessionStart ç™ºç«æ™‚"
      input:
        - "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœ€åˆã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ"
        - "state.mdï¼ˆplaybook, goalï¼‰"
        - "playbookï¼ˆactive ãªå ´åˆï¼‰"
      process:
        hooks:
          - "session.sh: SessionStart ã‚’ event unit ã«å§”è­²"
        subagents: []
        skills:
          - "session-manager: handlers/start.sh"
        claude_md: "INIT ã‚»ã‚¯ã‚·ãƒ§ãƒ³ â†’ [è‡ªèª] å‡ºåŠ›"
      output:
        - "[è‡ªèª] ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆwhat, milestone, phase, branch...ï¼‰"
        - "pending ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤"
      references:
        - ".claude/hooks/session.sh"
        - ".claude/events/session-start/chain.sh"
        - ".claude/skills/session-manager/handlers/start.sh"
        - "CLAUDE.md"
        - "state.md"

    - id: work_loop
      name: "LOOP"
      why: |
        playbook ã® phase ã‚’é †æ¬¡å®Ÿè¡Œã—ã€done_criteria ã‚’æº€ãŸã™ã¾ã§åå¾©ã™ã‚‹ã€‚
        critic ã«ã‚ˆã‚‹æ¤œè¨¼ã§å ±é…¬è©æ¬ºã‚’é˜²æ­¢ã—ã€ç¢ºå®Ÿãªå“è³ªã‚’ä¿è¨¼ã™ã‚‹ã€‚
      when: "INIT å®Œäº†å¾Œã€playbook ãŒå­˜åœ¨ã™ã‚‹å ´åˆ"
      input:
        - "playbookï¼ˆcurrent phase, done_criteriaï¼‰"
        - "subtasksï¼ˆcriterion, executor, test_commandï¼‰"
      process:
        hooks:
          - "pre-tool-edit chain: playbook/reward guards"
          - "pre-tool-bash chain: bash guards"
        subagents:
          - "critic: PASS/FAIL åˆ¤å®š"
        skills: []
        claude_md: "LOOP ã‚»ã‚¯ã‚·ãƒ§ãƒ³ â†’ subtask å®Ÿè¡Œ"
      output:
        - "ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ï¼ˆEdit/Writeï¼‰"
        - "test_command çµæœ"
        - "critic åˆ¤å®šï¼ˆPASS/FAILï¼‰"
        - "phase.status = doneï¼ˆPASS ã®å ´åˆï¼‰"
      references:
        - ".claude/events/pre-tool-edit/chain.sh"
        - ".claude/events/pre-tool-bash/chain.sh"
        - ".claude/skills/reward-guard/agents/critic.md"
        - "CLAUDE.md"

    - id: post_loop
      name: "POST_LOOP"
      why: |
        playbook å®Œäº†æ™‚ã«è‡ªå‹•ã§ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã€æ¬¡ playbook ä½œæˆã‚’è¡Œã†ã€‚
        æ‰‹å‹•æ“ä½œãªã—ã§ç¶™ç¶šçš„ãªé€²æ—ã‚’å®Ÿç¾ã™ã‚‹ã€‚
      when: "playbook ã®å…¨ phase ãŒ done"
      input:
        - "playbookï¼ˆå…¨ phase doneï¼‰"
      process:
        hooks:
          - "post-tool-edit chain: archive/cleanup/PR"
        subagents: []
        skills: []
        claude_md: "POST_LOOP ã‚»ã‚¯ã‚·ãƒ§ãƒ³ â†’ milestone æ›´æ–°"
      output:
        - "playbook ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼ˆplay/archive/<id>/ï¼‰"
        - "state.md æ›´æ–°ï¼ˆplaybook.active = nullï¼‰"
        - "æ¬¡ playbookï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰"
        - "/clear æ¨å¥¨ã‚¢ãƒŠã‚¦ãƒ³ã‚¹"
      references:
        - ".claude/events/post-tool-edit/chain.sh"
        - ".claude/skills/playbook-gate/workflow/archive-playbook.sh"
        - ".claude/skills/playbook-gate/workflow/cleanup.sh"
        - ".claude/skills/git-workflow/handlers/create-pr-hook.sh"
        - "CLAUDE.md"

    - id: critique_process
      name: "CRITIQUE"
      why: |
        ã€Œå®Œäº†ã€ã®è‡ªå·±åˆ¤æ–­ã‚’ç¦æ­¢ã—ã€critic SubAgent ã«ã‚ˆã‚‹å®¢è¦³çš„æ¤œè¨¼ã§å ±é…¬è©æ¬ºã‚’é˜²æ­¢ã€‚
        done_criteria ã®é”æˆã‚’è¨¼æ‹ ä»˜ãã§ç¢ºèªã€‚
      when: "phase å®Œäº†ç”³å‘Šæ™‚"
      input:
        - "phase.done_criteria"
        - "test_command å®Ÿè¡Œçµæœ"
        - "å¤‰æ›´å†…å®¹"
      process:
        hooks:
          - "critic-guard.sh: critic å®Ÿè¡Œãƒã‚§ãƒƒã‚¯"
        subagents:
          - "critic: done_criteria æ¤œè¨¼"
        skills: []
        claude_md: "CRITIQUE ã‚»ã‚¯ã‚·ãƒ§ãƒ³å‚ç…§"
      output:
        - "critic åˆ¤å®šï¼ˆPASS/FAILï¼‰"
        - "æ ¹æ‹ ï¼ˆevidenceï¼‰"
        - "ä¿®æ­£æŒ‡ç¤ºï¼ˆFAIL ã®å ´åˆï¼‰"
      references:
        - ".claude/skills/reward-guard/guards/critic-guard.sh"
        - ".claude/skills/reward-guard/agents/critic.md"
        - ".claude/frameworks/done-criteria-validation.md"
        - "CLAUDE.md"

# ==============================================================================
# å¤‰æ›´å±¥æ­´
# ==============================================================================
changelog:
  - date: "2026-01-27 23:29:20"
    action: "auto-generated"
    description: "playbook å®Œäº†æ™‚ã«è‡ªå‹•ç”Ÿæˆ"
