# 計画の仕組み（物語編）

> **3層の計画と4つのレイヤーを物語で理解する**

---

## 3層計画: 会社の組織に例えると

### 社長（Macro: project.md）
会社全体の方針を決める人。

「我が社の目標は **LLM が自律で開発できる環境を作ること** だ」

社長は最終ゴールだけを示す。細かいことは部下に任せる。

---

### 部長（Medium: playbook）
1つのプロジェクトを担当する人。

「今月は **ロールバック機能** を完成させる」

部長は社長の方針を受けて、具体的なプロジェクトを立ち上げる。
1つの playbook = 1つのプロジェクト。

---

### 担当者（Micro: Phase）
実際に手を動かす人。

「今日は **設計書を書く**」
「明日は **コードを書く**」
「明後日は **テストを書く**」

担当者は1日（1セッション）でやることに集中する。

---

## 物語: ロールバック機能を作る

### プロローグ

社長（project.md）が言った。
「ユーザーが間違えても戻せるように、ロールバック機能が欲しい」

部長（playbook）が計画を立てた。

```
playbook-rollback.md
- Phase 1: 設計
- Phase 2: 実装
- Phase 3: テスト
- Phase 4: ドキュメント
```

---

### 第1章: Phase 1 - 設計

担当者（Claude）が出社した。

スターター: 「今日は Phase 1 の設計です」

Claude は設計書を書く。

完了条件:
- [ ] 設計書が存在する
- [ ] レビューを受けた

クリティックが来る。「設計書見せて」
Claude: 「これです」
クリティック: 「PASS」

→ Phase 1 完了。状態を **done** に更新。

---

### 第2章: Phase 2 - 実装

翌日、担当者が出社。

スターター: 「今日は Phase 2 の実装です」

Claude はコードを書く。

完了条件:
- [ ] rollback() 関数がある
- [ ] 型定義がある

クリティックが来る。「コード見せて」
Claude: 「src/rollback.ts です」
クリティック: 「PASS」

→ Phase 2 完了。

---

### 第3章: 全 Phase 完了

Phase 3、Phase 4 も同様に進み...

部長（playbook）が報告する。
「ロールバック機能、完成しました」

社長（project.md）がチェックする。
「done_when の条件は満たしているか？」

```
done_when:
  - ロールバック機能が動作する ✅
  - テストがある ✅
  - ドキュメントがある ✅
```

社長: 「よし、このプロジェクトは完了だ」

---

## 4つのレイヤー: 4つのフロア

この会社には4つのフロアがある。

### 1F: plan-template（テンプレート開発）
playbook の書式を決めるフロア。
「こういうフォーマットで計画を書いてね」
→ **完了済み**

### 2F: workspace（仕組み開発）
Claude Code 自体の仕組みを改善するフロア。
Hooks や SubAgents を作る。
→ **完了済み**

### 3F: setup（環境構築）
新人さんが入ってきたときに案内するフロア。
「まずこれをインストールしてね」
→ **完了済み**

### 4F: product（プロダクト開発）
実際のプロダクトを作るフロア。
ここがメインの作業場所。
→ **現在ここで作業中**

---

## 状態の流れ: 1日の過ごし方

朝起きてから寝るまで、順番がある。

1. **pending**（ベッドの中）: まだ何もしてない
2. **designing**（朝食を食べながら計画）: 今日何するか考える
3. **implementing**（仕事中）: 実際にやる
4. **reviewing**（振り返り）: ちゃんとできたか確認
5. **state_update**（日記を書く）: 記録を残す
6. **done**（就寝）: 完了！

**近道は禁止:**
- 朝起きていきなり仕事 → ダメ（計画しろ）
- 仕事してすぐ寝る → ダメ（振り返りしろ）

---

## 4つの連動: 4つの歯車

```
focus.current ←→ layer.state
      ↑              ↓
   branch    ←→  playbook
```

この4つは歯車のように連動している。

- **focus**: 今どのフロアにいる？
- **state**: 今どの状態？
- **playbook**: 今どの計画を実行中？
- **branch**: 今どのブランチで作業中？

1つがズレると、全部の歯車が噛み合わなくなる。
だから **チェッカー** が常に整合性を監視している。
