# 失敗カタログ

> **文書の位置付け**: 過去の失敗とその対策の記録
>
> **MECE 役割**: 失敗パターン・原因・対策・検証方法の SSOT
>
> **作成日**: 2026-01-22

---

## 概要

このドキュメントは、過去の失敗とその対策を記録します。
新しい実装やレビュー時に参照し、同じ失敗を繰り返さないようにします。

---

## F-001: Hook チェーンの複雑化

### 発生状況
Hook を第一層として自動強制を目指した

### 症状
- Hook 間の依存関係が暗黙的になり、デバッグ不能に
- 一つの Hook を修正すると別の Hook が壊れる
- Hook の数が増え続け、管理不能に

### 根本原因
LLM の非決定性を Hook で「強制」しようとした

### 対策
- Hook は Phase 4 まで使わない
- Hook は「検出・通知」のみ、「強制」は禁止
- 3層防御戦略を採用（Rules → Skills → Hooks）

### 検証方法
- Hook のコードに「強制」ロジックがないことを確認
- Hook が BLOCK を返す箇所を最小限に制限

---

## F-002: playbook が人間に読めない

### 発生状況
JSON のみで playbook を設計

### 症状
- コンテキスト0で playbook を理解できない
- 手動での編集が困難
- デバッグ時に状態を把握できない

### 根本原因
機械可読性のみを優先した

### 対策
- JSON + Markdown 二層化
- plan.json（SSOT）+ PLAYBOOK.md（人間可読ビュー）
- 同期スクリプトで両者を連携

### 検証方法
- 非技術者が PLAYBOOK.md を読んで理解できるか
- PLAYBOOK.md を編集して plan.json に反映されるか

---

## F-003: セッション永続化なし

### 発生状況
長期タスクで Claude Code セッションがリセット

### 症状
- 作業状態が失われ、最初からやり直し
- 中断ポイントが不明
- 進捗が把握できない

### 根本原因
セッション永続化を設計しなかった

### 対策
- Phase 1 で session.json + session.events.jsonl を導入
- Resume（中断再開）/ Fork（ブランチ分岐）を実装
- 状態機械でセッションをラップ

### 検証方法
- セッション中断後、別セッションで Resume できるか
- session.events.jsonl から状態を復元できるか

---

## F-004: 暗黙の前提

### 発生状況
ドキュメントに書かれていない前提知識が必要

### 症状
- コンテキスト0で再現不能
- 「なぜこうなっているか」が分からない
- 新規参加者がオンボーディングできない

### 根本原因
「分かっているはず」という思い込み

### 対策
- 全ての前提を明文化
- GLOSSARY.md で用語定義
- 各ドキュメントに「前提条件」セクションを追加

### 検証方法
- コンテキスト0で README を読み、目的を理解できるか
- 「なぜ？」に対する答えがドキュメントにあるか

---

## F-005: 検証の後回し

### 発生状況
作ってから検証しようとした

### 症状
- 作りっぱなし、品質が不明
- バグが蓄積
- リファクタリングが困難

### 根本原因
テスト設計が実装より後だった

### 対策
- 各 Phase に検証を含める
- 仕様先行（仕様 → テスト → 実装）
- done_criteria を先に定義

### 検証方法
- Phase 完了前にレビュー・テストが PASS するか
- 仕様変更時にテストが失敗するか

---

## F-006: Issue codes の複雑さ

### 発生状況
Issue codes（I-RF-1, I-DL-1 など）で失敗を分類

### 症状
- コードが多すぎて暗記できない
- Issue 毎の対応ロジックが複雑
- 実装コストが高い

### 根本原因
失敗を詳細に分類しすぎた

### 対策
- 3回ルールを採用
- 「3回失敗 → エスカレーション」のシンプルなルール
- 失敗の詳細分類は人間が判断

### 検証方法
- 3回失敗後に自動でエスカレーションされるか
- シンプルなルールで十分か

---

## F-007: Event Unit のスコープ肥大化

### 発生状況
Event Unit に多くの責務を持たせた

### 症状
- ロジックが重複
- 変更の影響範囲が予測できない
- テストが困難

### 根本原因
Hook とWorkflow の責務を分離しなかった

### 対策
- Event Unit は「ガード/テレメトリ/復旧補助」のみ
- ロジックは Workflow に移動
- 重複を禁止

### 検証方法
- Event Unit にビジネスロジックがないか
- ロジックが Workflow に集約されているか

---

## F-008: 手動コマンドの不在

### 発生状況
全てを自動化しようとした

### 症状
- ユーザーが制御できない
- デバッグが困難
- 意図しない動作が発生

### 根本原因
「自動化 = 良い」という思い込み

### 対策
- Phase 0 で手動コマンド（/plan /work /review）を導入
- 自動化は Phase 4 まで待つ
- ユーザーが明示的にコマンドを発行する設計

### 検証方法
- 手動コマンドで全ての操作ができるか
- 自動化がなくても動作するか

---

## F-009: 状態管理の一元化

### 発生状況
state.md に全ての状態を集約

### 症状
- ファイルが肥大化
- 更新競合が発生
- 責務が不明確

### 根本原因
SSOT を厳密に解釈しすぎた

### 対策
- 責務分割（decisions.md / patterns.md / .claude/state/）
- state.md は「現在状態」のみ
- セッション状態は session.json に分離

### 検証方法
- 各ファイルの責務が明確か
- 更新競合が発生しないか

---

## F-010: レビュー/テストの定義不明確

### 発生状況
レビュー・テストの手順が曖昧だった

### 症状
- レビュアーによって結果が異なる
- テストの網羅性が不明
- 品質基準がない

### 根本原因
レビュー・テストを厳密に定義しなかった

### 対策
- REVIEW-PROTOCOL.md でレビューを厳密に定義
- TEST-PROTOCOL.md でテストを厳密に定義
- 5観点/5種別のフレームワークを導入

### 検証方法
- コンテキスト0で同じレビュー結果になるか
- テストの網羅性が測定可能か

---

## 失敗パターンの分類

### カテゴリ A: 設計思想の誤り

| ID | 概要 |
|----|------|
| F-001 | Hook チェーンの複雑化 |
| F-008 | 手動コマンドの不在 |

### カテゴリ B: 人間可読性の軽視

| ID | 概要 |
|----|------|
| F-002 | playbook が人間に読めない |
| F-004 | 暗黙の前提 |

### カテゴリ C: 状態管理の問題

| ID | 概要 |
|----|------|
| F-003 | セッション永続化なし |
| F-009 | 状態管理の一元化 |

### カテゴリ D: 検証の問題

| ID | 概要 |
|----|------|
| F-005 | 検証の後回し |
| F-010 | レビュー/テストの定義不明確 |

### カテゴリ E: 複雑さの問題

| ID | 概要 |
|----|------|
| F-006 | Issue codes の複雑さ |
| F-007 | Event Unit のスコープ肥大化 |

---

## 参照

- HARNESS-ANALYSIS.md（harness 分析結果）
- IMPLEMENTATION-PLAN-V2.md（改善後の実装計画）
